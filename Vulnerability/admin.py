from django.contrib import admin
from django.utils.html import format_html

from .models import Vulnerability


@admin.register(Vulnerability)
class VulnerabilityAdmin(admin.ModelAdmin):

    def namespace_link(self):
        return format_html(
            '<a href="/{app_name}/{db_table}/{db_table_primary_key}/change/">{db_table_field}</a>'.format(
                app_name=self.namespace._meta.app_label, db_table=self.namespace._meta.db_table,
                db_table_primary_key=self.namespace.id, db_table_field=self.namespace.name))

    namespace_link.short_description = "Namespace"
    namespace_link.admin_order_field = "namespace"
    list_display = ('name', namespace_link, 'severity', 'severity_source')
    readonly_fields = ('namespace',)
    search_fields = ('name', 'namespace', 'severity', 'severity_source')
    ordering = ('name', 'severity', 'severity_source')
    list_per_page = 20
    list_display_links = ('name', namespace_link, 'severity', 'severity_source')
    list_filter = ('severity', 'severity_source', 'namespace',)
